---
layout: blog
title: 4.4 윈도우함수
date: 2025-08-13 16:00:00 +0900
categories: [TIL, sqld, 4_SQL_활용]
permalink: /blog/posts/25-08-13-TIL
---

### 4.4.1 윈도우함수의 개념

**윈도우함수** : 행과 행 간의 관계를 나타내는 연산을 쉽게 하기 위한 함수. 각 행의 기존 구성을 유지한 상태로 새로운 칼럼을 추가하거나 기존의 칼럼을 변경한다. 모든 윈도우함수는 OVER 키워드와 함께 사용된다.

이후의 윈도우함수 예제에서는 그룹함수에서와 같이 아래 테이블을 사용한다.

<table style="width:75%" border="1">
  <caption>STUDENT</caption>
  <thead>
    <tr>
      <th>DEPARTMENT</th>
      <th>GRADE</th>
      <th>SCORE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>소프트웨어학과</td>
      <td>1학년</td>
      <td>3.7</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>2학년</td>
      <td>4.1</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>2학년</td>
      <td>2.6</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>3학년</td>
      <td>3.5</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>2학년</td>
      <td>3.6</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>3학년</td>
      <td>4.2</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>4학년</td>
      <td>2.9</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>4학년</td>
      <td>3.7</td>
    </tr>
  </tbody>
</table>
<br>

### 4.4.2 순위함수

**순위함수** : 순위를 계산하는 함수.

<table style="width:85%" border="1">
  <thead>
    <tr>
      <th style="width:25%">함수명</th>
      <th style="width:50%">설명</th>
      <th style="width:25%">예</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>RANK</td>
      <td>동일 순위는 같은 순위값을 가지며,<br>순위는 누적 순위 + 1이 된다.</td>
      <td>1,2,2,4,4,4,7</td>
    </tr>
    <tr>
      <td>DENSE_RANK</td>
      <td>동일 순위는 같은 순위값을 가지며,<br>순위는 앞 순위 + 1이 된다.</td>
      <td>1,2,2,3,3,3,4</td>
    </tr>
    <tr>
      <td>ROW_NUMBER</td>
      <td>동일 순위라도 각각의 행이<br>고유한 순위를 가진다.</td>
      <td>1,2,3,4,5,6,7</td>
    </tr>
  </tbody>
</table>
<br>

**①**<br>
<b>SELECT DEPARTMENT, GRADE, SCORE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;RANK() OVER(ORDER BY SCORE DESC) AS RANK<br>
FROM STUDENT;<br></b>
=> SCORE가 높은 것부터 순위를 매긴다. 순위는 누적 순위 + 1.

<table style="width:75%" border="1">
  <caption>실행결과</caption>
  <thead>
    <tr>
      <th style="width:28%">DEPARTMENT</th>
      <th>GRADE</th>
      <th>SCORE</th>
      <th>RANK</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>해고방지학과</td>
      <td>3학년</td>
      <td>4.2</td>
      <td>1</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>2학년</td>
      <td>4.1</td>
      <td>2</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>1학년</td>
      <td>3.7</td>
      <td>3</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>4학년</td>
      <td>3.7</td>
      <td>3</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>2학년</td>
      <td>3.6</td>
      <td>5</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>3학년</td>
      <td>3.5</td>
      <td>6</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>4학년</td>
      <td>2.9</td>
      <td>7</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>2학년</td>
      <td>2.6</td>
      <td>8</td>
    </tr>
  </tbody>
</table>

**②**<br>
<b>SELECT DEPARTMENT, GRADE, SCORE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;DENSE_RANK() OVER(ORDER BY SCORE DESC) AS RANK<br>
FROM STUDENT;<br></b>
=> SCORE가 높은 것부터 순위를 매긴다. 순위는 앞 순위 + 1.

<table style="width:75%" border="1">
  <caption>실행결과</caption>
  <thead>
    <tr>
      <th style="width:28%">DEPARTMENT</th>
      <th>GRADE</th>
      <th>SCORE</th>
      <th>RANK</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>해고방지학과</td>
      <td>3학년</td>
      <td>4.2</td>
      <td>1</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>2학년</td>
      <td>4.1</td>
      <td>2</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>1학년</td>
      <td>3.7</td>
      <td>3</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>4학년</td>
      <td>3.7</td>
      <td>3</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>2학년</td>
      <td>3.6</td>
      <td>4</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>3학년</td>
      <td>3.5</td>
      <td>5</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>4학년</td>
      <td>2.9</td>
      <td>6</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>2학년</td>
      <td>2.6</td>
      <td>7</td>
    </tr>
  </tbody>
</table>

**③**<br>
<b>SELECT DEPARTMENT, GRADE, SCORE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;ROW_NUMBER() OVER(ORDER BY SCORE DESC) AS RANK<br>
FROM STUDENT;<br></b>
=> SCORE가 높은 것부터 순위를 매긴다. 행 인덱스를 순위로 갖는다.

<table style="width:75%" border="1">
  <caption>실행결과</caption>
  <thead>
    <tr>
      <th style="width:28%">DEPARTMENT</th>
      <th>GRADE</th>
      <th>SCORE</th>
      <th>RANK</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>해고방지학과</td>
      <td>3학년</td>
      <td>4.2</td>
      <td>1</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>2학년</td>
      <td>4.1</td>
      <td>2</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>1학년</td>
      <td>3.7</td>
      <td>3</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>4학년</td>
      <td>3.7</td>
      <td>4</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>2학년</td>
      <td>3.6</td>
      <td>5</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>3학년</td>
      <td>3.5</td>
      <td>6</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>4학년</td>
      <td>2.9</td>
      <td>7</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>2학년</td>
      <td>2.6</td>
      <td>8</td>
    </tr>
  </tbody>
</table>
<br>

### 4.4.3 집계함수

**집계함수** : 앞에서 배운 집계함수와 같다. OVER절을 함께 사용하여 파티션 별로 집계하거나 누적 집계를 계산할 수 있다.

**PATITION BY** : OVER와 같이 사용하여 원본 행을 유지하며 그룹별 계산 수행을 돕는다.

<table style="width:85%" border="1">
  <thead>
    <tr>
      <th style="width:17%">함수명</th>
      <th style="width:83%">설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>COUNT</td>
      <td>값이 존재하는 행의 개수를 파티션 별로 집계하거나 누적 집계를 반환한다.</td>
    </tr>
    <tr>
      <td>SUM</td>
      <td>파티션 별 합계를 구하거나 누적 합계를 반환한다.</td>
    </tr>
    <tr>
      <td>AVG</td>
      <td>파티션 별 평균을 구하거나 누적 평균을 반환한다.</td>
    </tr>
    <tr>
      <td>MIN</td>
      <td>파티션 별 최솟값을 반환한다.</td>
    </tr>
    <tr>
      <td>MAX</td>
      <td>파티션 별 최댓값을 반환한다.</td>
    </tr>
  </tbody>
</table>
<br>

**①**<br>
<b>SELECT DEPARTMENT, GRADE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;COUNT(\*) OVER(PARTITION BY GRADE) AS PART_CNT<br>
FROM STUDENT;<br></b>
=> 학년별로 파티션을 나누고 파티션별 개수를 구한다.

<table style="width:75%" border="1">
  <caption>실행결과</caption>
  <thead>
    <tr>
      <th>DEPARTMENT</th>
      <th>GRADE</th>
      <th>PART_CNT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>소프트웨어학과</td>
      <td>1학년</td>
      <td>1</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>2학년</td>
      <td>3</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>2학년</td>
      <td>3</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>2학년</td>
      <td>3</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>3학년</td>
      <td>2</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>3학년</td>
      <td>2</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>4학년</td>
      <td>2</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>4학년</td>
      <td>2</td>
    </tr>
  </tbody>
</table>

**②**<br>
<b>SELECT DEPARTMENT, GRADE, SCORE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;MAX(SCORE) OVER(PARTITION BY GRADE) AS PART_MAX<br>
FROM STUDENT;<br></b>
=> 학년별로 파티션을 나누고 파티션별 SCORE 최댓값을 구한다.

<table style="width:75%" border="1">
  <caption>실행결과</caption>
  <thead>
    <tr>
      <th>DEPARTMENT</th>
      <th>GRADE</th>
      <th>SCORE</th>
      <th>PART_MAX</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>소프트웨어학과</td>
      <td>1학년</td>
      <td>3.7</td>
      <td>3.7</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>2학년</td>
      <td>4.1</td>
      <td>4.1</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>2학년</td>
      <td>2.6</td>
      <td>4.1</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>2학년</td>
      <td>3.6</td>
      <td>4.1</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>3학년</td>
      <td>3.5</td>
      <td>4.2</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>3학년</td>
      <td>4.2</td>
      <td>4.2</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>4학년</td>
      <td>2.9</td>
      <td>3.7</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>4학년</td>
      <td>3.7</td>
      <td>3.7</td>
    </tr>
  </tbody>
</table>
<br>

### 4.4.4 행 순서함수

<table style="width:85%" border="1">
  <thead>
    <tr>
      <th style="width:25%">함수명</th>
      <th style="width:75%">설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>FIRST_VALUE</td>
      <td>파티션 별로 가장 처음 값을 반환한다.</td>
    </tr>
    <tr>
      <td>LAST_VALUE</td>
      <td>파티션 별로 가장 마지막 값을 반환한다.</td>
    </tr>
    <tr>
      <td>LAG</td>
      <td>입력된 인자의 값만큼 이전 행의 값을 반환한다.</td>
    </tr>
    <tr>
      <td>LEAD</td>
      <td>입력된 인자의 값만큼 이후 행의 값을 반환한다.</td>
    </tr>
  </tbody>
</table>
<br>

**①**<br>
<b>SELECT DEPARTMENT, GRADE, SCORE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;FIRST_VALUE(SCORE) OVER(PARTITION BY GRADE) AS PART_FIRST<br>
FROM STUDENT;<br></b>
=> 학년별로 파티션을 나누고 파티션별 첫 번째 SCORE를 구한다.

<table style="width:75%" border="1">
  <caption>실행결과</caption>
  <thead>
    <tr>
      <th>DEPARTMENT</th>
      <th>GRADE</th>
      <th>SCORE</th>
      <th>PART_FIRST</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>소프트웨어학과</td>
      <td>1학년</td>
      <td>3.7</td>
      <td>3.7</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>2학년</td>
      <td>4.1</td>
      <td>4.1</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>2학년</td>
      <td>2.6</td>
      <td>4.1</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>2학년</td>
      <td>3.6</td>
      <td>4.1</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>3학년</td>
      <td>3.5</td>
      <td>3.5</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>3학년</td>
      <td>4.2</td>
      <td>3.5</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>4학년</td>
      <td>2.9</td>
      <td>2.9</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>4학년</td>
      <td>3.7</td>
      <td>2.9</td>
    </tr>
  </tbody>
</table>

**②**<br>
<b>SELECT DEPARTMENT, GRADE, SCORE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;LAG(SCORE, 2) OVER(ORDER BY SCORE) AS SCORE_2<br>
FROM STUDENT;<br></b>
=> SCORE 순으로 정렬하고 2행 앞의 SCORE값을 구한다.

<table style="width:75%" border="1">
  <caption>실행결과</caption>
  <thead>
    <tr>
      <th>DEPARTMENT</th>
      <th>GRADE</th>
      <th>SCORE</th>
      <th>SCORE_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>소프트웨어학과</td>
      <td>2학년</td>
      <td>2.6</td>
      <td class="grey">[NULL]</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>4학년</td>
      <td>2.9</td>
      <td class="grey">[NULL]</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>3학년</td>
      <td>3.5</td>
      <td>2.6</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>2학년</td>
      <td>3.6</td>
      <td>2.9</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>1학년</td>
      <td>3.7</td>
      <td>3.5</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>4학년</td>
      <td>3.7</td>
      <td>3.6</td>
    </tr>
    <tr>
      <td>소프트웨어학과</td>
      <td>2학년</td>
      <td>4.1</td>
      <td>3.7</td>
    </tr>
    <tr>
      <td>해고방지학과</td>
      <td>3학년</td>
      <td>4.2</td>
      <td>3.7</td>
    </tr>
  </tbody>
</table>
<br>

### 4.4.5 비율함수

**비율함수** : 파티션 별로 전체 개수나 합계를 구한 후, 그에 대한 비율을 구하는 함수.

<table style="width:85%" border="1">
  <thead>
    <tr>
      <th style="width:30%">함수명</th>
      <th style="width:70%">설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>CUME_DIST</td>
      <td>파티션 별로 해당 값 이하 행의 전체에 대한 비율을 반환한다. 마지막 행의 값이 1이 된다.</td>
    </tr>
    <tr>
      <td>PERCENT_RANK</td>
      <td>파티션 별로 순위별 백분율을 반환한다. 가장 첫 행이 0, 마지막 행이 1이 된다.</td>
    </tr>
    <tr>
      <td>NTILE</td>
      <td>파티션을 N등분하여 1부터 N까지의 등급 값을 반환한다. 전체 개수를 N으로 나누고 나머지를 앞 등급 순서로 1씩 배분하여 등급별 개수를 정한다.</td>
    </tr>
    <tr>
      <td>RATIO_TO_REPORT</td>
      <td>인자값의 파티션 별 합계에 대한 비율을 반환한다.</td>
    </tr>
  </tbody>
</table>
<br>

<b>SELECT DEPARTMENT, GRADE, SCORE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;ROUND(CUME_DIST() OVER(ORDER BY SCORE), 3) AS C_DIST,<br>
&nbsp;&nbsp;&nbsp;&nbsp;ROUND(PERCENT_RANK() OVER(ORDER BY SCORE), 3) AS P_RANK,<br>
&nbsp;&nbsp;&nbsp;&nbsp;NTILE(3) OVER(ORDER BY SCORE) AS NTILE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;ROUND(RATIO_TO_REPORT(SCORE) OVER(), 3) AS REPORT<br>
FROM STUDENT<br>
ORDER BY SCORE;<br></b>

<table style="width:90%" border="1">
  <caption>실행결과</caption>
  <thead>
    <tr>
      <th style="width:17%">DEPARTMENT</th>
      <th>GRADE</th>
      <th>SCORE</th>
      <th>C_DIST</th>
      <th>P_RANK</th>
      <th>NTILE</th>
      <th>REPORT</th>
    </tr>
  </thead>
  <tbody>
    <tr><td>소프트웨어학과</td><td>2학년</td><td>2.6</td><td>0.125</td><td>0.000</td><td>1</td><td>0.092</td></tr>
    <tr><td>해고방지학과</td><td>4학년</td><td>2.9</td><td>0.250</td><td>0.143</td><td>1</td><td>0.103</td></tr>
    <tr><td>소프트웨어학과</td><td>3학년</td><td>3.5</td><td>0.375</td><td>0.286</td><td>1</td><td>0.124</td></tr>
    <tr><td>해고방지학과</td><td>2학년</td><td>3.6</td><td>0.500</td><td>0.429</td><td>2</td><td>0.127</td></tr>
    <tr><td>소프트웨어학과</td><td>1학년</td><td>3.7</td><td>0.750</td><td>0.571</td><td>2</td><td>0.131</td></tr>
    <tr><td>해고방지학과</td><td>4학년</td><td>3.7</td><td>0.750</td><td>0.571</td><td>2</td><td>0.131</td></tr>
    <tr><td>소프트웨어학과</td><td>2학년</td><td>4.1</td><td>0.875</td><td>0.857</td><td>3</td><td>0.145</td></tr>
    <tr><td>해고방지학과</td><td>3학년</td><td>4.2</td><td>1.000</td><td>1.000</td><td>3</td><td>0.148</td></tr>
  </tbody>
</table>
