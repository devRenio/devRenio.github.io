---
layout: blog
title: 복합 쿼리 예제 - 2
date: 2025-08-08 21:00:00 +0900
categories: [TIL, sqld, 3_SQL_기본]
permalink: /blog/posts/25-08-08-TIL/
---

### 복합 쿼리 예제 - 2

여러 테이블을 연결하는 복합 쿼리를 하나 살펴본다. 이 예제에서는 도서관 대출시스템에서 도서별로 처음 기록된 대출의 도서명, 출판사, 대출시작일자, 대출종료일자를 조회하는 쿼리를 살펴본다.<br><br>

도서 테이블 생성 :

<b>CREATE TABLE 도서 (<br>
&nbsp;&nbsp;&nbsp;&nbsp;도서ID NUMBER CONSTRAINT PK\_도서 PRIMARY KEY,<br>
&nbsp;&nbsp;&nbsp;&nbsp;도서명 NVARCHAR2(100)<br>
);

... 예시 데이터 입력 ...

데이터가 입력된 테이블 :

<table style="width:75%" border="1">
  <caption>도서</caption>
  <thead>
    <tr>
      <th>도서ID</th>
      <th>도서명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>12001</td>
      <td>SQLD 모든 것</td>
    </tr>
    <tr>
      <td>12002</td>
      <td>자료구조</td>
    </tr>
    <tr>
      <td>12003</td>
      <td>운영체제</td>
    </tr>
  </tbody>
</table>
<br>

출판사 테이블 생성 :

<b>CREATE TABLE 출판사 (<br>
&nbsp;&nbsp;&nbsp;&nbsp;출판사ID NUMBER CONSTRAINT PK\_출판사 PRIMARY KEY,<br>
&nbsp;&nbsp;&nbsp;&nbsp;출판사명 NVARCHAR2(100)<br>
);

... 예시 데이터 입력 ...

데이터가 입력된 테이블 :

<table style="width:75%" border="1">
  <caption>출판사</caption>
  <thead>
    <tr>
      <th>출판사ID</th>
      <th>출판사명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1001</td>
      <td>아이리포</td>
    </tr>
    <tr>
      <td>1002</td>
      <td>생능</td>
    </tr>
    <tr>
      <td>1003</td>
      <td>한빛</td>
    </tr>
  </tbody>
</table>
<br>

대출 테이블 생성 :

<b>CREATE TABLE 대출 (<br>
&nbsp;&nbsp;&nbsp;&nbsp;대출번호 NUMBER CONSTRAINT PK\_대출 PRIMARY KEY,<br>
&nbsp;&nbsp;&nbsp;&nbsp;도서ID NUMBER CONSTRAINT FK\_도서\_대출\_REL11 FOREIGN KEY<br>
&nbsp;&nbsp;&nbsp;&nbsp;REFERENCES 도서(도서ID),<br>
&nbsp;&nbsp;&nbsp;&nbsp;출판사ID NUMBER NOT NULL CONSTRAINT FK\_출판사\_대출\_REL21 FOREIGN KEY<br>
&nbsp;&nbsp;&nbsp;&nbsp;REFERENCES 출판사(출판사ID),<br>
&nbsp;&nbsp;&nbsp;&nbsp;대출시작일자 DATE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;대출종료일자 DATE<br>
);

... 예시 데이터 입력 ...

데이터가 입력된 테이블 :

<table style="width:75%" border="1">
  <caption>대출</caption>
  <thead>
    <tr>
      <th>대출번호</th>
      <th>도서ID</th>
      <th>출판사ID</th>
      <th>대출시작일자</th>
      <th>대출종료일자</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>101</td>
      <td>12001</td>
      <td>1001</td>
      <td>2025-06-03</td>
      <td>2025-06-13</td>
    </tr>
    <tr>
      <td>102</td>
      <td>12001</td>
      <td>1001</td>
      <td>2025-07-11</td>
      <td>2025-07-21</td>
    </tr>
    <tr>
      <td>103</td>
      <td>12002</td>
      <td>1002</td>
      <td>2025-08-02</td>
      <td>2025-08-12</td>
    </tr>
    <tr>
      <td>104</td>
      <td>12002</td>
      <td>1002</td>
      <td>2025-07-15</td>
      <td>2025-07-25</td>
    </tr>
    <tr>
      <td>105</td>
      <td>12003</td>
      <td>1003</td>
      <td>2025-07-16</td>
      <td>2025-07-26</td>
    </tr>
    <tr>
      <td>106</td>
      <td>12003</td>
      <td>1003</td>
      <td>2025-06-29</td>
      <td>2025-07-08</td>
    </tr>
  </tbody>
</table>
<br>

쿼리 전문 :

<b>
SELECT B.도서명, C.출판사명,<br>
&nbsp;&nbsp;&nbsp;&nbsp;TO_CHAR(A.대출시작일자, 'YYYY-MM-DD') AS 대출시작일자,<br>
&nbsp;&nbsp;&nbsp;&nbsp;TO_CHAR(A.대출종료일자, 'YYYY-MM-DD') AS 대출종료일자<br>
FROM 대출 A, 도서 B, 출판사 C,<br>
&nbsp;&nbsp;&nbsp;&nbsp;(SELECT 도서ID, MIN(대출시작일자) AS 대출시작일자<br>
&nbsp;&nbsp;&nbsp;&nbsp;FROM 대출<br>
&nbsp;&nbsp;&nbsp;&nbsp;GROUP BY 도서ID) D<br>
WHERE A.대출시작일자 = D.대출시작일자<br>
&nbsp;&nbsp;&nbsp;&nbsp;AND B.도서ID = D.도서ID<br>
&nbsp;&nbsp;&nbsp;&nbsp;AND A.도서ID = B.도서ID<br>
&nbsp;&nbsp;&nbsp;&nbsp;AND A.출판사ID = C.출판사ID<br>
ORDER BY B.도서명;</b><br><br>

실행 순서 :

**① SELECT(서브쿼리) -> ② WHERE -> ③ SELECT -> ④ ORDER BY**<br><br>

<table style="width:75%" border="1">
  <caption>실행결과</caption>
  <thead>
    <tr>
      <th>도서명</th>
      <th>출판사명</th>
      <th>대출시작일자</th>
      <th>대출종료일자</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>SQLD 모든 것</td>
      <td>아이리포</td>
      <td>2025-06-03</td>
      <td>2025-06-13</td>
    </tr>
    <tr>
      <td>운영체제</td>
      <td>한빛</td>
      <td>2025-06-29</td>
      <td>2025-07-08</td>
    </tr>
    <tr>
      <td>자료구조</td>
      <td>생능</td>
      <td>2025-07-15</td>
      <td>2025-07-25</td>
    </tr>
  </tbody>
</table>
