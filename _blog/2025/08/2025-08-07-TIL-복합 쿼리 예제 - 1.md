---
layout: blog
title: 복합 쿼리 예제 - 1
date: 2025-08-07 22:00:00 +0900
categories: [TIL, sqld, 3_SQL_기본]
permalink: /blog/posts/25-08-07-TIL/
---

### 복합 쿼리 예제 - 1

WHERE, GROUP BY, HAVING, ORDER BY가 모두 포함된 복합 쿼리를 하나 살펴본다. 이 예제에서는 회원들의 주문금액 데이터를 분석해서 특정 기간으로 필터링한 뒤 기간 내 2회 이상 주문한 회원들의 주문금액의 합계와 최고주문금액을 구하고자 한다.<br><br>

사용할 테이블 생성 :

<b>CREATE TABLE TBL (<br>
&nbsp;&nbsp;&nbsp;&nbsp;주문번호 VARCHAR(5) PRIMARY KEY,<br>
&nbsp;&nbsp;&nbsp;&nbsp;회원번호 VARCHAR(5) NOT NULL,<br>
&nbsp;&nbsp;&nbsp;&nbsp;주문일시 VARCHAR(8) NOT NULL,<br>
&nbsp;&nbsp;&nbsp;&nbsp;주문금액 NUMBER NOT NULL<br>
);
</b><br><br>

예시 데이터 입력 :

<b>INSERT INTO TBL VALUES('001', 'A001', '20250802', 1000);<br>
.<br>
.<br>
.</b><br><br>

데이터가 입력된 테이블 :

<table style="width:75%" border="1">
  <caption>TBL</caption>
  <thead>
    <tr>
      <th>주문번호</th>
      <th>회원번호</th>
      <th>주문일시</th>
      <th>주문금액</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>001</td>
      <td>A001</td>
      <td>20250802</td>
      <td>1000</td>
    </tr>
    <tr>
      <td>002</td>
      <td>A001</td>
      <td>20250810</td>
      <td>3000</td>
    </tr>
    <tr>
      <td>003</td>
      <td>A002</td>
      <td>20250803</td>
      <td>2000</td>
    </tr>
    <tr>
      <td>004</td>
      <td>A002</td>
      <td>20250811</td>
      <td>2000</td>
    </tr>
    <tr>
      <td>005</td>
      <td>A002</td>
      <td>20250815</td>
      <td>2000</td>
    </tr>
    <tr>
      <td>006</td>
      <td>A003</td>
      <td>20250804</td>
      <td>1000</td>
    </tr>
    <tr>
      <td>007</td>
      <td>A003</td>
      <td>20250814</td>
      <td>4000</td>
    </tr>
    <tr>
      <td>008</td>
      <td>A003</td>
      <td>20250821</td>
      <td>1000</td>
    </tr>
    <tr>
      <td>009</td>
      <td>A003</td>
      <td>20250824</td>
      <td>1000</td>
    </tr>
    <tr>
      <td>010</td>
      <td>A004</td>
      <td>20250810</td>
      <td>2000</td>
    </tr>
  </tbody>
</table>
<br>

쿼리 전문 :

<b>
SELECT 회원번호, MAX(주문금액) AS 최고주문금액, SUM(주문금액) AS 주문금액합계<br>
FROM TBL<br>
WHERE 주문일시 BETWEEN '20250801' AND '20250815'<br>
GROUP BY 회원번호<br>
HAVING COUNT(*) >= 2<br>
ORDER BY 주문금액합계 DESC;</b><br><br>

실행 순서 :

**① WHERE -> ② GROUP BY -> ③ HAVING -> ④ SELECT -> ⑤ ORDER BY**<br><br>

<table style="width:75%" border="1">
  <caption>실행결과</caption>
  <thead>
    <tr>
      <th>회원번호</th>
      <th>최고주문금액</th>
      <th>주문금액합계</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>A002</td>
      <td>2000</td>
      <td>6000</td>
    </tr>
    <tr>
      <td>A003</td>
      <td>4000</td>
      <td>5000</td>
    </tr>
    <tr>
      <td>A001</td>
      <td>3000</td>
      <td>4000</td>
    </tr>
  </tbody>
</table>
