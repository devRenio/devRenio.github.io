---
layout: blog
title: 4.1 서브쿼리
date: 2025-08-10 18:00:00 +0900
categories: [TIL, sqld, 4_SQL_활용]
permalink: /blog/posts/25-08-10-TIL
---

### 4.1.1 서브쿼리의 개념

**서브쿼리(Subquery)** : SQL문은 하나의 결과를 반환하는 독립적인 사용자 함수와 같은 기능을 한다. 따라서 함수가 들어갈 수 있는 위치에는 그에 맞는 결과를 반환하는 별도의 SQL문을 삽입할 수 있으며, 이를 서브쿼리라고 한다. 서브쿼리를 품고 있는 쿼리를 상대적인 표현으로 메인쿼리라고 한다. 서브쿼리는 반드시 괄호로 감싸서 사용해야 하며, 삽입되는 위치에 따라 다음과 같이 분류할 수 있다.

<table style="width:75%" border="1">
  <thead>
    <tr>
      <th style="width:25%">종류</th>
      <th>삽입되는 위치</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>스칼라 서브쿼리</td>
      <td>SELECT문의 칼럼 입력 위치</td>
    </tr>
    <tr>
      <td>인라인 뷰</td>
      <td>FROM절의 테이블 입력 위치</td>
    </tr>
    <tr>
      <td>중첩 서브쿼리</td>
      <td>WHERE절, HAVING절의 칼럼 또는 테이블 입력 위치</td>
    </tr>
  </tbody>
</table>

또한 메인쿼리의 칼럼 사용 여부에 따라 다음과 같이 분류할 수 있다.

<table style="width:75%" border="1">
  <thead>
    <tr>
      <th style="width:25%">종류</th>
      <th>메인쿼리 칼럼 사용 여부</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>연관 서브쿼리</td>
      <td>메인쿼리의 칼럼을 서브쿼리에서 사용</td>
    </tr>
    <tr>
      <td>비연관 서브쿼리</td>
      <td>메인쿼리의 칼럼을 서브쿼리에서 비사용</td>
    </tr>
  </tbody>
</table>
<br>

### 4.1.2 스칼라 서브쿼리

**스칼라 서브쿼리** : SELECT문의 칼럼이 입력되는 위치(SELECT, ORDER BY 등)에 들어가는 서브쿼리.

<b>SELECT A.NAME,<br>
&nbsp;&nbsp;&nbsp;&nbsp;(SELECT B.NUM<br>
&nbsp;&nbsp;&nbsp;&nbsp;FROM TEST2 B) AS NUM<br>
FROM TEST1 A;</b><br><br>

### 4.1.3 인라인 뷰

**인라인 뷰(INline View)** : FROM절의 테이블이 입력되는 위치에 들어가는 서브쿼리. 쿼리 실행 시 생성되는 동적 테이블로 볼 수 있다.

<b>SELECT A.NAME<br>
FROM (SELECT NAME<br>
&nbsp;&nbsp;&nbsp;&nbsp;FROM TEST) AS A;</b>

**뷰(View)** : 서브쿼리의 반환 결과로 생성된 테이블에 별도로 이름을 붙여서 DBMS에 등록해 놓고 테이블을 참조하듯이 사용할 수 있도록 한 것. 해당 뷰를 참조할 때 동적으로 메모리에 생성되는 임시/가상 테이블이다.

<table style="width:85%" border="1">
  <caption>테이블과 뷰의 차이점</caption>
  <thead>
    <tr>
      <th style="width:17%"></th>
      <th>테이블</th>
      <th>뷰</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="font-weight:bold">개념</td>
      <td>정의된 스키마에 따라<br>실제 데이터를 물리적으로 생성.</td>
      <td>실제 테이블을 참조하여<br>생성하는 논리적인 가상 테이블.</td>
    </tr>
    <tr>
      <td style="font-weight:bold">데이터 저장</td>
      <td>실제 데이터를 디스크에 저장.</td>
      <td>실제 데이터를 저장하지 않음.</td>
    </tr>
    <tr>
      <td style="font-weight:bold">생성 방식</td>
      <td>정적으로 생성.</td>
      <td>동적으로 생성.</td>
    </tr>
    <tr>
      <td style="font-weight:bold">인덱스 생성</td>
      <td>고유 인덱스 생성 가능.</td>
      <td>고유 인덱스 생성 불가능.</td>
    </tr>
    <tr>
      <td style="font-weight:bold">삽입/수정/삭제</td>
      <td>제약 없음.</td>
      <td>제약 있음.</td>
    </tr>
  </tbody>
</table>

<table style="width:85%" border="1">
  <caption>뷰의 특징</caption>
  <thead>
    <tr>
      <th style="width:17%">특징</th>
      <th>설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>편리성</td>
      <td>복잡하고 긴 쿼리를 단순하게 작성할 수 있다.</td>
    </tr>
    <tr>
      <td>보안성</td>
      <td>기존 테이블에서 특정 칼럼을 제외시키고 뷰를 생성하여 제공할 수 있다.</td>
    </tr>
    <tr>
      <td>독립성</td>
      <td>테이블의 구조가 변경되더라도 뷰를 통한 접근은 변경할 필요가 없다.</td>
    </tr>
  </tbody>
</table>

<b>CREATE OR REPLACE VIEW V_TEST AS<br>
[ SELECT 등의 쿼리문 ];<br></b>
=> V_TEST 뷰를 생성한다.

**SELECT \* FROM V_TEST;**<br>
=> V_TEST 뷰의 모든 칼럼을 조회한다. (테이블처럼 사용할 수 있다.)

**DROP VIEW V_TEST;**<br>
=> V_TEST 뷰를 삭제한다.<br><br>

### 4.1.4 중첩 서브쿼리

**중첩 서브쿼리** : 쿼리 안에 다른 쿼리가 중첩되어 들어간 경우, 특히 WHERE절과 HAVING절에 들어가는 서브쿼리. 스칼라 서브쿼리, 인라인 뷰와 다르게 여러 형태의 반환값을 가질 수 있다.

<table style="width:75%" border="1">
  <thead>
    <tr>
      <th style="width:25%">반환값 유형</th>
      <th>설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>단일행</td>
      <td>반환되는 값이 단일행인 경우.<br>단일행 비교연산자의 연산 대상으로 지정할 수 있다.</td>
    </tr>
    <tr>
      <td>다중행</td>
      <td>반환되는 값이 다중행인 경우.<br>다중행 비교연산자의 연산 대상으로 지정할 수 있다.</td>
    </tr>
    <tr>
      <td>다중칼럼</td>
      <td>반환되는 값이 여러 칼럼(벡터), 즉 테이블인 경우.</td>
    </tr>
  </tbody>
</table>

**① 단일행** :<br>
<b>SELECT NAME,<br>
&nbsp;&nbsp;&nbsp;&nbsp;SCORE<br>
FROM STUDENT<br>
WHERE SCORE >= (SELECT AVG(S.SCORE) FROM STUDENT S);<br></b>
=> 학점이 평균 이상인 학생을 조회.

**② 다중행** :<br>
<b>SELECT NAME,<br>
&nbsp;&nbsp;&nbsp;&nbsp;SCORE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;MAJOR<br>
FROM STUDENT<br>
WHERE MAJOR IN (SELECT DISTINCT MAJOR<br>
&nbsp;&nbsp;&nbsp;&nbsp;FROM STUDENT<br>
&nbsp;&nbsp;&nbsp;&nbsp;WHERE SCORE <= 2.7);<br></b>
=> 학점이 2.7이하인 학생이 있는 전공의 학생들을 조회.

**③ 다중칼럼** :<br>
<b>SELECT NAME,<br>
&nbsp;&nbsp;&nbsp;&nbsp;SCORE,<br>
&nbsp;&nbsp;&nbsp;&nbsp;MAJOR<br>
FROM STUDENT<br>
WHERE (SCORE, MAJOR) IN (SELECT MAX(SCORE), MAJOR<br>
&nbsp;&nbsp;&nbsp;&nbsp;FROM STUDENT<br>
&nbsp;&nbsp;&nbsp;&nbsp;GROUP BY MAJOR);<br></b>
=> 전공별로 가장 학점이 높은 학생을 조회.
